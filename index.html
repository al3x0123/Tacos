<div class="container">
    <div class="card">
        <h2>ğŸŒ® TaquerÃ­a Fidelidad ğŸ¦ˆ</h2>
        
        <div id="adminSection">
            <div class="search-box admin-only">
                <input type="text" id="phone" placeholder="Nombre o TelÃ©fono">
                <button onclick="checkClient()">Buscar</button>
            </div>
            <div class="lock-status" onclick="unlockAdmin()" id="adminLock">ğŸ”“ Admin Mode</div>
        </div>

        <div id="displayArea" style="display:none;" class="client-info">
            <h3 id="clientName"></h3>
            <div class="grid" id="stampGrid"></div>
            <p id="counterText"></p>
            <div id="rewardMsg" class="reward" style="display:none;">ğŸ Â¡TACO GRATIS! ğŸŒ®</div>
            
            <button class="admin-only" style="background:var(--success); width:100%" onclick="addStamp()">+1 Sello</button>
            
            <button id="btnQR" style="background:var(--dark); width:100%; margin-top:10px" onclick="generateQR()">Generar mi cÃ³digo QR</button>
            <div id="qrcode" style="display:flex; justify-content:center; margin-top:10px"></div>
        </div>
    </div>

    <div class="client-list admin-only">
        <h3>Lista de Clientes (Cloud)</h3>
        <div id="fullList"></div>
    </div>
</div>

<script>
    window.isAdmin = false;

    // DÃ©tection immÃ©diate du mode client
    const urlParams = new URLSearchParams(window.location.search);
    const isClientMode = urlParams.has('user');

    if (isClientMode) {
        // Si c'est un client, on cache toute la partie Admin (mÃªme le bouton de dÃ©verrouillage)
        document.getElementById('adminSection').style.display = 'none';
        document.getElementById('btnQR').style.display = 'none'; // Le client n'a pas besoin de gÃ©nÃ©rer son propre QR
    }

    window.unlockAdmin = function() {
        const pin = prompt("PIN:");
        if (pin === "1234") {
            window.isAdmin = true;
            document.querySelectorAll('.admin-only').forEach(e => e.style.display = 'block');
            document.getElementById('adminLock').innerHTML = "âœ… Modo Administrador Activo";
            window.updateFullList();
        } else {
            alert("PIN Incorrecto");
        }
    }

    window.generateQR = function() {
        const qrDiv = document.getElementById('qrcode');
        qrDiv.innerHTML = "";
        const url = window.location.origin + window.location.pathname + "?user=" + encodeURIComponent(window.currentClient);
        new QRCode(qrDiv, { text: url, width: 128, height: 128 });
    }

    window.loadClient = function(name) {
        document.getElementById('phone').value = name;
        window.checkClient();
    }
</script>
